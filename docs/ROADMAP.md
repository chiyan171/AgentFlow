# AgentFlow 产品路线图

## v1.1.0 - 智能权限管理（规划中）

**发布时间：** 待定

**主题：** 真·自动化 - 告别权限弹窗

### 🎯 核心目标

将 AgentFlow 从「半自动化」升级到「真·自动化」，消除频繁权限确认对开发流程的打断。

### 📊 当前痛点

```mermaid
graph LR
    A[用户发起工作流] --> B[@implement 修改代码]
    B --> C{弹窗: 允许修改文件?}
    C --> D[用户点击 Allow]
    D --> E[@implement 创建文件]
    E --> F{弹窗: 允许创建文件?}
    F --> G[用户点击 Allow]
    G --> H[@tester 运行测试]
    H --> I{弹窗: 允许执行命令?}
    I --> J[用户点击 Allow]
    J --> K[工作流完成]
    
    style C fill:#ff6b6b
    style F fill:#ff6b6b
    style I fill:#ff6b6b
```

**问题分析：**
- ❌ 每次文件操作都需要手动授权
- ❌ 用户体验割裂，打断开发心流
- ❌ 承诺的「自动化」实际是「半自动化」
- ❌ 频繁弹窗降低工作效率 50%+

### ✨ 核心特性

#### 1. 会话级批量授权机制

```yaml
# 用户首次授权后，同一会话内不再重复询问
session:
  remember_choice: true          # 记住决策
  remember_duration: 60          # 有效期 60 分钟
  batch_approval: true           # 支持批量授权
```

**工作流示意：**

```mermaid
graph LR
    A[用户发起工作流] --> B{首次授权?}
    B -->|是| C[弹窗: 本次会话记住我的选择?]
    C --> D[用户确认一次]
    D --> E[@implement 修改代码]
    E --> F[@implement 创建文件]
    F --> G[@tester 运行测试]
    G --> H[工作流完成]
    B -->|否| E
    
    style C fill:#51cf66
    style D fill:#51cf66
```

**效果：**
- ✅ 从 N 次确认 → 1 次确认
- ✅ 权限弹窗减少 90%
- ✅ 工作流执行速度提升 80%

#### 2. Agent 权限模型

基于 Agent 角色的细粒度权限控制：

| Agent | 权限级别 | 允许操作 | 限制操作 |
|-------|---------|---------|---------|
| `@plan` | 只读 | 读文件、搜索代码、分析结构 | 不能修改文件/执行命令 |
| `@implement` | 读写 | 读写文件、创建文件、编辑代码 | 不能执行命令/删除文件 |
| `@reviewer` | 只读 | 读文件、代码审查、提出建议 | 不能修改文件/执行命令 |
| `@tester` | 完整 | 读写文件、运行测试、生成报告 | 无限制（测试环境） |
| `@debug` | 完整 | 读写文件、调试执行、分析日志 | 无限制（调试场景） |

**配置示例：**

```yaml
agents:
  "@plan":
    permissions:
      - read_file
      - list_directory
      - search_code
      - semantic_search
  
  "@implement":
    permissions:
      - read_file
      - write_file
      - create_file
      - edit_file
```

**优势：**
- ✅ 低风险 Agent 无需授权（如 @plan 只读操作）
- ✅ 高风险操作自动拦截并提示
- ✅ 清晰的权限边界，符合最小权限原则

#### 3. 工作区信任配置

声明式配置文件 `agentflow-trust.yml`：

```yaml
# ==================== 基础配置 ====================
trusted: true              # 是否信任此工作区
execution_mode: preview    # 执行模式: preview/auto/strict

# ==================== 文件路径权限 ====================
paths:
  allowed:
    - "src/**"             # 允许修改源码
    - "tests/**"           # 允许修改测试
    - "**/*.md"            # 允许修改文档
  denied:
    - ".env*"              # 禁止修改环境变量
    - "**/*.key"           # 禁止修改密钥文件
    - "**/secrets/**"      # 禁止修改敏感目录

# ==================== 命令权限 ====================
commands:
  allowed:
    - "npm.*"              # 允许 npm 命令
    - "git.*"              # 允许 git 命令
    - "pytest.*"           # 允许测试命令
  denied:
    - "rm -rf.*"           # 禁止删除命令
    - "sudo.*"             # 禁止提权命令
```

**三种执行模式：**

1. **Preview 模式（推荐）**
   - 可信操作：显示预览面板，自动执行
   - 危险操作：弹窗确认
   - 适用场景：企业项目、生产环境

2. **Auto 模式**
   - 可信操作：静默自动执行
   - 危险操作：弹窗确认
   - 适用场景：个人项目、开源项目

3. **Strict 模式**
   - 所有操作：都需确认
   - 适用场景：未知项目、安全敏感项目

#### 4. VS Code 扩展集成

开发独立扩展 `agentflow-vscode`：

**功能特性：**
- 🎨 **可视化配置界面**：GUI 配置 agentflow-trust.yml
- 📋 **操作预览面板**：实时预览即将执行的操作
- 📊 **授权历史记录**：查看所有授权决策历史
- 🔔 **智能通知系统**：高危操作弹窗提醒
- 🛡️ **安全策略模板**：内置企业/个人/开源项目模板

**界面 Mockup：**

```
┌─────────────────────────────────────────────┐
│ AgentFlow 操作预览                          │
├─────────────────────────────────────────────┤
│ Agent: @implement                            │
│ 操作: 修改文件                               │
│                                              │
│ 将执行以下操作:                              │
│ ✏️  修改 src/utils.ts (3 处更改)           │
│ ➕ 创建 src/helpers.ts                      │
│ 🗑️  删除 src/deprecated.ts                 │
│                                              │
│ 风险评估: 低风险 ✅                          │
│                                              │
│ [ ] 本次会话记住我的选择                     │
│                                              │
│ [取消]  [查看详情]  [允许执行]              │
└─────────────────────────────────────────────┘
```

### 📅 开发计划

#### Phase 1 - 基础架构（Week 1-2）
- [ ] 设计会话管理系统
- [ ] 实现权限决策引擎
- [ ] 开发配置文件解析器
- [ ] 编写单元测试

#### Phase 2 - Agent 集成（Week 3-4）
- [ ] 为 5 个 Agents 添加权限检查
- [ ] 实现权限拦截器
- [ ] 集成操作预览逻辑
- [ ] 测试不同 Agent 的权限场景

#### Phase 3 - CLI 工具（Week 5）
- [ ] `agentflow trust init`：生成配置模板
- [ ] `agentflow trust validate`：验证配置合法性
- [ ] `agentflow trust audit`：查看授权日志
- [ ] 更新安装脚本

#### Phase 4 - VS Code 扩展（Week 6-8）
- [ ] 开发 agentflow-vscode 扩展
- [ ] 实现可视化配置界面
- [ ] 实现操作预览面板
- [ ] 集成通知系统
- [ ] 发布到 VS Code Marketplace

#### Phase 5 - 文档与测试（Week 9-10）
- [ ] 编写《自动化权限管理指南》
- [ ] 录制演示视频
- [ ] 进行 Beta 测试
- [ ] 收集用户反馈并迭代

#### Phase 6 - 正式发布（Week 11-12）
- [ ] 性能优化与 Bug 修复
- [ ] 发布 v1.1.0 正式版
- [ ] 更新所有文档
- [ ] 社区推广

### 🎉 预期效果

**定量指标：**
- ✅ 权限弹窗数量减少 **90%**
- ✅ 工作流执行速度提升 **80%**
- ✅ 用户满意度提升 **50%**
- ✅ 新手上手时间缩短 **60%**

**定性提升：**
- ✅ 从「半自动化」升级到「真·自动化」
- ✅ 无感知的权限管理，不打断开发心流
- ✅ 保持高安全性的同时提升易用性
- ✅ 成为业界自动化程度最高的 AI 编程助手

### 🎯 竞品对比

| 特性 | AgentFlow 5.3 | Cursor | Windsurf | Devin |
|-----|---------------|---------|----------|-------|
| 会话级授权 | ✅ | ❌ | ❌ | ⚠️ 部分 |
| Agent 权限模型 | ✅ | ❌ | ❌ | ❌ |
| 声明式配置 | ✅ | ❌ | ❌ | ❌ |
| 操作预览 | ✅ | ⚠️ 简单 | ❌ | ✅ |
| 授权记忆 | ✅ | ❌ | ❌ | ❌ |

**竞争优势：**
- 🏆 **唯一支持会话级批量授权**的 AI 编程工具
- 🏆 **唯一基于 Agent 角色的权限模型**
- 🏆 成本最低（$10/月）+ 自动化程度最高

---

## v6.0.0 - 企业协作（远期规划）

**主题：** 从个人工具到团队平台

### 核心特性（待定）
- 🏢 多人协作模式
- 📊 团队级项目记忆共享
- 🔐 企业级安全与审计
- 📈 工作流性能分析
- 🎓 团队知识库沉淀

---

## 贡献与反馈

我们欢迎社区贡献想法和建议！

- 💡 **功能建议**：[GitHub Issues](https://github.com/your-org/agentflow/issues)
- 🐛 **Bug 反馈**：[GitHub Issues](https://github.com/your-org/agentflow/issues)
- 💬 **讨论交流**：[GitHub Discussions](https://github.com/your-org/agentflow/discussions)
- 📧 **商务合作**：contact@agentflow.dev

---

**最后更新：** 2026-02-08  
**文档版本：** v1.0
